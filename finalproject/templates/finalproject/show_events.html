<!-- # File: show_events.html
# Author: Mohammed Abaherah (abaherah@bu.edu) 25 April 2025
# Description: display page for events -->

{% extends "finalproject/base.html" %}
{% load static %}

{% block content %}

<h1>Plan Your Events </h1>

<!-- Category Filter -->
<form method="get" action="{% url 'show_events' %}" style="margin-bottom: 20px;">
  <label for="category">Filter by Category:</label>
  <select name="category" id="category">
    <option value="">-- All --</option>
    <option value="concerts" {% if selected_category == 'concerts' %}selected{% endif %}>Concerts</option>
    <option value="sports" {% if selected_category == 'sports' %}selected{% endif %}>Sports</option>
    <option value="expos" {% if selected_category == 'expos' %}selected{% endif %}>Expos</option>
    <option value="festivals" {% if selected_category == 'festivals' %}selected{% endif %}>Festivals</option>
    <option value="community" {% if selected_category == 'community' %}selected{% endif %}>Community</option>
  </select>
  <button type="submit">Apply Filter</button>
</form>

<div id="calendar"></div>

{{ calendar_events|json_script:"calendar-data" }}

<!-- FullCalendar CSS and JS so I can make the events laid out nice -->
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    var calendarEl = document.getElementById('calendar');

    var events = JSON.parse(document.getElementById('calendar-data').textContent);

    var calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'dayGridMonth',
      events: events,
      eventClick: function(info) {
        if (confirm('Do you want to RSVP to "' + info.event.title + '"?')) {
          var form = document.createElement('form');
          form.method = 'POST';
          form.action = '{% url "rsvp_event" %}';
          
          var csrfToken = '{{ csrf_token }}';

          form.innerHTML = `
            <input type="hidden" name="csrfmiddlewaretoken" value="${csrfToken}">
            <input type="hidden" name="event_id" value="${info.event.id}">
            <input type="hidden" name="event_title" value="${info.event.title}">
          `;

          document.body.appendChild(form);
          form.submit();
        }
      }
    });

    calendar.render();
  });
</script>

{% endblock %}
